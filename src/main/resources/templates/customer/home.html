<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple E-commerce</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <style>
        .dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            min-width: 150px;
        }
        .dropdown-menu a {
            display: block;
            padding: 10px;
            text-decoration: none;
            color: #333;
            font-size: 14px;
        }
        .dropdown-menu a:hover {
            background-color: #f1f5f9;
        }
        .dropdown:hover .dropdown-menu {
            display: block;
        }
        .product-card {
            position: relative;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 15px;
            text-align: left;
        }
        .product-card img {
            max-width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .product-card .info {
            margin-bottom: 10px;
        }
        .product-card .info h2 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .product-card .info p {
            font-size: 14px;
            color: gray;
            margin-bottom: 5px;
        }
        .product-card .actions {
            display: flex;
            justify-content: space-between;
        }
        .product-card .btn {
            display: inline-block;
            padding: 8px 12px;
            color: white;
            background-color: #007bff;
            text-decoration: none;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }
        .product-card .btn:hover {
            background-color: #0056b3;
        }
        .btn-add-to-cart {
            background-color: #28a745;
        }
        .btn-add-to-cart:hover {
            background-color: #218838;
        }
        .filter-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .filter-container input,
        .filter-container select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-white shadow p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">MINIMARKET</h1>
            <div class="flex items-center space-x-4">
                <!-- Profile Dropdown -->
                <div class="relative dropdown">
                    <button class="text-blue-600 hover:text-blue-800 flex items-center">
                        <i class="fas fa-user mr-2"></i> Profile
                    </button>
                    <div class="dropdown-menu">
                        <a href="/customer/profile/view"><i class="fas fa-eye mr-2"></i> View Profile</a>
                        <a href="/transactions/customer"><i class="fas fa-history mr-2"></i> Transaction History</a>
                        <a href="/auth/logout"><i class="fas fa-sign-out-alt mr-2"></i> Logout</a>
                    </div>
                </div>
                <!-- Cart Button -->
                <button class="text-blue-600 hover:text-blue-800" onclick="location.href='/customer/cart/view'">
                    <i class="fas fa-shopping-cart"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Jumbotron -->
    <section class="bg-gray-200 py-10 text-center">
        <div class="container mx-auto">
            <h2 class="text-4xl font-bold mb-2">Welcome to the MINIMARKET</h2>
            <p class="text-gray-600">Happy shopping and enjoy exploring our products!</p>
        </div>
    </section>

    <!-- Product List -->
    <main class="container mx-auto mt-8">
        <div class="filter-container">
            <!-- Search -->
            <input type="text" id="searchBar" placeholder="Search by product name..." class="w-1/2">
            <!-- Sort -->
            <select id="sortOptions" class="w-1/4">
                <option value="">Sort by</option>
                <option value="price-asc">Price: Low to High</option>
                <option value="price-desc">Price: High to Low</option>
            </select>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" id="productGrid">
            <div class="product-card" th:each="product : ${products}">
                <img th:src="${product.imageUrl}" alt="Product Image">
                <div class="info">
                    <h2 th:text="${product.name}">Sample Product</h2>
                    <p th:text="${product.category}">Category</p>
                    <p class="text-red-500 font-bold" th:text="'Rp ' + ${product.price}">Rp 100.000</p>
                </div>
                <div class="actions">
                    <a th:href="'/customer/products/detail/' + ${product.id}" class="btn">View Details</a>
                    <button class="btn btn-add-to-cart" th:attr="onclick='addToCart(' + ${product.id} + ')'">Add to Cart</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        const searchBar = document.getElementById('searchBar');
        const sortOptions = document.getElementById('sortOptions');
        const productGrid = document.getElementById('productGrid');
        const products = Array.from(productGrid.children);

        searchBar.addEventListener('input', () => {
            const query = searchBar.value.toLowerCase();
            products.forEach(product => {
                const name = product.querySelector('h2').textContent.toLowerCase();
                product.style.display = name.includes(query) ? 'block' : 'none';
            });
        });

        sortOptions.addEventListener('change', () => {
            const sortValue = sortOptions.value;
            const sortedProducts = products.sort((a, b) => {
                const priceA = parseInt(a.querySelector('.text-red-500').textContent.replace(/\D/g, ''), 10);
                const priceB = parseInt(b.querySelector('.text-red-500').textContent.replace(/\D/g, ''), 10);
                return sortValue === 'price-asc' ? priceA - priceB : priceB - priceA;
            });

            productGrid.innerHTML = '';
            sortedProducts.forEach(product => productGrid.appendChild(product));
        });

        function addToCart(productId) {
            fetch('/customer/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `productId=${productId}&quantity=1`,
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to add to cart.');
                }
                alert('Product added to cart!');
            })
            .catch(error => {
                console.error(error);
                alert('Could not add product to cart. Please try again.');
            });
        }
    </script>
</body>
</html>
